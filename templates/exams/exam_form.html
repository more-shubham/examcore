{% extends 'base.html' %}

{% block title %}{% if is_edit %}Edit Exam{% else %}Create Exam{% endif %}{% endblock %}

{% block content %}
  <div class="max-w-2xl mx-auto">
  <!-- Header -->
    <div class="mb-6">
      <a href="{% url 'exams:list' %}" class="inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-2">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
        Back to Exams
      </a>
      <h1 class="text-2xl font-bold text-gray-900">{% if is_edit %}Edit Exam{% else %}Create Exam{% endif %}</h1>
    </div>

  <!-- Form -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
      <form method="post" class="space-y-6">
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="text-sm text-red-600">{{ form.non_field_errors.0 }}</p>
          </div>
        {% endif %}

      <!-- Title -->
        <div>
          <label for="{{ form.title.id_for_label }}" class="form-label">Title *</label>
          {{ form.title }}
          {% if form.title.errors %}
            <p class="field-error">{{ form.title.errors.0 }}</p>
          {% endif %}
        </div>

      <!-- Description -->
        <div>
          <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
          {{ form.description }}
          {% if form.description.errors %}
            <p class="field-error">{{ form.description.errors.0 }}</p>
          {% endif %}
        </div>

      <!-- Subject Selection -->
        <div>
          <label for="{{ form.subject.id_for_label }}" class="form-label">Subject *</label>
          {{ form.subject }}
          {% if form.subject.errors %}
            <p class="field-error">{{ form.subject.errors.0 }}</p>
          {% endif %}
        </div>

      <!-- Timing -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="{{ form.start_time.id_for_label }}" class="form-label">Start Time *</label>
            {{ form.start_time }}
            {% if form.start_time.errors %}
              <p class="field-error">{{ form.start_time.errors.0 }}</p>
            {% endif %}
          </div>
          <div>
            <label for="{{ form.end_time.id_for_label }}" class="form-label">End Time *</label>
            {{ form.end_time }}
            {% if form.end_time.errors %}
              <p class="field-error">{{ form.end_time.errors.0 }}</p>
            {% endif %}
          </div>
        </div>

      <!-- Question Selection Mode -->
        <div class="border border-gray-200 rounded-lg p-4 space-y-4">
          <p class="form-label">Question Selection</p>

          <div class="flex items-center">
            <label class="inline-flex items-center cursor-pointer">
              {{ form.use_random_questions }}
              <span class="ml-2 text-sm font-medium text-gray-700">Random question selection</span>
            </label>
          </div>
          <p class="text-xs text-gray-500 ml-6">When enabled, questions will be randomly selected from the class question bank.</p>

          <div id="random-count-section">
            <label for="{{ form.random_question_count.id_for_label }}" class="form-label">Number of Questions</label>
            {{ form.random_question_count }}
            {% if form.random_question_count.errors %}
              <p class="field-error">{{ form.random_question_count.errors.0 }}</p>
            {% endif %}
            <p class="text-xs text-gray-500 mt-1">How many questions to include in the exam.</p>
          </div>
        </div>

      <!-- Status -->
        <div>
          <label for="{{ form.status.id_for_label }}" class="form-label">Status *</label>
          {{ form.status }}
          {% if form.status.errors %}
            <p class="field-error">{{ form.status.errors.0 }}</p>
          {% endif %}
          <p class="text-xs text-gray-500 mt-1">Students can only see published exams.</p>
        </div>

      <!-- Submit -->
        <div class="flex items-center justify-end space-x-3 pt-4 border-t border-gray-200">
          <a href="{% url 'exams:list' %}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200">
            Cancel
          </a>
          <button type="submit" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700">
            {% if is_edit %}Update Exam{% else %}Create Exam{% endif %}
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Toggle random question count visibility based on checkbox
    const randomCheckbox = document.getElementById('{{ form.use_random_questions.id_for_label }}');
    const randomCountSection = document.getElementById('random-count-section');

    function toggleRandomCount() {
      if (randomCheckbox && randomCountSection) {
        if (randomCheckbox.checked) {
          randomCountSection.style.display = 'block';
        } else {
          randomCountSection.style.display = 'none';
        }
      }
    }

    if (randomCheckbox) {
      randomCheckbox.addEventListener('change', toggleRandomCount);
      toggleRandomCount(); // Initial state
    }
  </script>
{% endblock %}
